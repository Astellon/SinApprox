# 覚書

## Phase クラス

内部データはuint32。
はじめはエイリアスで宣言しようと考えていたがコンストラクタが欲しかったのでわざわざクラスにした。
中にuint32表現の定数も入ってる。

一応ビット数を気にしてuint32_tを使ってる(処理系による違いで鉞を受けている人を見たことがあるのでビビって安定をとってるが、まあよくわかってない)。

## pade近似

[資料](http://suzublog.hatenablog.com/entry/2018/01/21/182247)を参考にuint->doubleに変換している。
[資料](http://suzublog.hatenablog.com/entry/2018/01/21/182247)ではfloatに変換しているため定数が異なるが仕組みは同じ。
近似式はなんやかんやあって(5次式)/(2次式)を使ってる。
コメントアウトしているが(3次式)/(2次式)でもそこそこ精度がいい。
sin(double)のほうは再帰を使ってシンプルに書いている(これがシンプルに見えるかは人それぞれ)。

## テーブル引き

テーブルの生成過程と本体を隠蔽するため無名名前空間を使っている。
一応テーブルはグローバルな空間に置かれているので実行時に初期化される
(ここらへんは黒魔術感あるのでいい方法があれば変更したい)(でもわざわざ関数でinitしたくない)。
テーブルは0~pi/2を256分割したものだが、大きさを257としている。これは線形補完する際に255+1番目の値を参照する場合があるためである。

テーブルのインデックスを求めるために、上位2ビットを捨てて0~pi/2に正規化し、下位22ビットも捨てて値が0~255に入るようにしてる。
捨てた下位22ビットを見ると今のインデックスと一つは先のインデックスの間のどこらへんかがわかるのでこれをdoubleに変換し補完する。

## test.cpp

測定では256個のバッファーをサンプルレート44.1kHzで440Hzのsin波で埋めてる。
知ってるのがstd::chronoしかないので使ってる感じ。時間の測定ってこれでいいの？
誤差は平均二乗誤差を使ってる。多分これが一番それっぽい。

### 参考資料

- [Padé Approximant - WolframMathWorld](http://mathworld.wolfram.com/PadeApproximant.html)
- [pade.mws](http://homepages.math.uic.edu/~jan/MCS471/Lec25/pade.html)
- [MUSIC_DSP SOURCE CODE](http://www.musicdsp.org/archive.php?classid=1)
- [2PIでループする位相変数をUINTに正規化すると美味い - 落胆がらくた街](http://suzublog.hatenablog.com/entry/2018/01/21/182247)
